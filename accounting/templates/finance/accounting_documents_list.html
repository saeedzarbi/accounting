{% extends "base.html" %}
{% block title %}اسناد حسابداری — سامانه حسابداری املاک{% endblock %}
{% block body_class %}accounts-page{% endblock %}
{% block extra_head %}
  <style>
    .accounts-page .shell-content { align-items: flex-start; padding-top: 1.5rem; padding-bottom: 3rem; }
    .accounts-header { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 2rem; }
    .accounts-back { display: inline-flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; color: var(--color-text-muted); }
    .accounts-back:hover { color: var(--color-accent); }
    .accounts-table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .accounts-table th, .accounts-table td { padding: 10px 8px; border-bottom: 1px solid rgba(148, 163, 184, 0.2); text-align: right; }
    .accounts-table th { color: var(--color-text-muted); font-weight: 600; font-size: 13px; }
    .doc-type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 12px;
      background: rgba(37, 99, 235, 0.2);
      border: 1px solid rgba(96, 165, 250, 0.5);
      color: #93c5fd;
    }
    .doc-type-badge.receipt { background: rgba(34, 197, 94, 0.2); border-color: rgba(34, 197, 94, 0.5); color: #86efac; }
    .doc-type-badge.payment { background: rgba(251, 191, 36, 0.2); border-color: rgba(251, 191, 36, 0.5); color: #fde047; }
    .doc-type-badge.commission { background: rgba(168, 85, 247, 0.2); border-color: rgba(168, 85, 247, 0.5); color: #c4b5fd; }
    .empty-state { padding: 24px 16px; color: var(--color-text-muted); font-size: 14px; text-align: center; border: 1px dashed rgba(148, 163, 184, 0.3); border-radius: 16px; }
    .pagination-wrap { margin-top: 1.25rem; display: flex; justify-content: center; flex-wrap: wrap; gap: 6px; }
    .pagination-wrap a, .pagination-wrap span {
      display: inline-flex; align-items: center; justify-content: center; min-width: 36px; height: 36px; padding: 0 10px;
      border-radius: 10px; font-size: 13px; border: 1px solid rgba(148, 163, 184, 0.3); color: var(--color-text-muted); text-decoration: none;
    }
    .pagination-wrap a:hover { color: var(--color-accent); border-color: var(--color-accent); }
    .pagination-wrap .current { background: var(--color-accent); color: #fff; border-color: var(--color-accent); }
    .pagination-wrap .disabled { opacity: 0.5; pointer-events: none; }
    .doc-link { color: var(--color-accent); }
    .doc-link:hover { text-decoration: underline; }
    .doc-desc { max-width: 220px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  </style>
{% endblock %}
{% block content %}
  <div class="page-card">
    <div class="page-card-inner">
      <div class="accounts-header">
        <a class="accounts-back" href="{% url 'dashboard' %}">بازگشت به داشبورد</a>
        <h1 class="page-title">
          اسناد حسابداری <span>لیست اسناد</span>
        </h1>
        <p class="page-subtitle">مشاهده و مدیریت اسناد حسابداری مرتبط با معاملات و تراکنش‌های بنگاه.</p>
      </div>
      {% if documents %}
        <table class="accounts-table">
          <thead>
            <tr>
              <th>شماره سند</th>
              <th>نوع سند</th>
              <th>تاریخ</th>
              <th>شرح</th>
              <th>معامله</th>
            </tr>
          </thead>
          <tbody>
            {% for doc in documents %}
              <tr>
                <td>{{ doc.number|default:doc.id }}</td>
                <td>
                  <span class="doc-type-badge {{ doc.doc_type }}">{{ doc.get_doc_type_display }}</span>
                </td>
                <td>{{ doc.date|date:"Y/m/d" }}</td>
                <td class="doc-desc" title="{{ doc.description }}">{{ doc.description|truncatewords:8|default:"—" }}</td>
                <td>
                  {% if doc.deal_id %}
                    <a class="doc-link" href="{% url 'deal-detail' id=doc.deal_id %}">معامله #{{ doc.deal_id }}</a>
                  {% else %}
                    —
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if page_obj.has_other_pages %}
          <div class="pagination-wrap">
            {% if page_obj.has_previous %}
              <a href="?page=1">«</a>
              <a href="?page={{ page_obj.previous_page_number }}">‹</a>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
              {% if num == page_obj.number %}
                <span class="current">{{ num }}</span>
              {% elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
                <a href="?page={{ num }}">{{ num }}</a>
              {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
              <a href="?page={{ page_obj.next_page_number }}">›</a>
              <a href="?page={{ page_obj.paginator.num_pages }}">»</a>
            {% endif %}
          </div>
        {% endif %}
      {% else %}
        <div class="empty-state">
          هنوز سند حسابداری ثبت نشده است. با ثبت و تایید معاملات، اسناد کمیسیون به‌صورت خودکار ایجاد می‌شوند.
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
