{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% load finance_tags %}
{% block title %}Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ â€” {{ deal.title|default:deal.id }}{% endblock %}
{% block body_class %}deal-accounts-page{% endblock %}
{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/deal_accounts.css' %}">
{% endblock %}
{% block content %}
  <div class="page-card deal-accounts-card">
    <div class="page-card-inner">
      {% comment %} Ø³Ø±Ø¨Ø±Ú¯ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù‚Ø¯Ø§Ù… {% endcomment %}
      <header class="deal-accounts-hero">
        <nav class="deal-accounts-nav">
          <a class="deal-accounts-back" href="{% url 'dashboard' %}">
            <span class="deal-accounts-back-icon" aria-hidden="true">â†</span>
            <span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
          </a>
          <div class="deal-accounts-actions">
            <button type="button"
                    class="deal-detail-btn deal-detail-btn--ghost"
                    id="openDealDetailModal"
                    aria-label="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø¹Ø§Ù…Ù„Ù‡">Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø¹Ø§Ù…Ù„Ù‡</button>
            {% if deal_accounts_list %}
              <button type="button"
                      class="deal-detail-btn deal-detail-btn--primary"
                      id="openRegisterPaymentModal"
                      aria-label="Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯">Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´</button>
            {% endif %}
          </div>
        </nav>
        <div class="deal-accounts-hero-title">
          <h1 class="deal-accounts-title">{{ deal.title|default:"Ù…Ø¹Ø§Ù…Ù„Ù‡" }} â€” Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§</h1>
          <span class="deal-accounts-pill" aria-hidden="true">Ø¯ÙØªØ± Ø­Ø³Ø§Ø¨</span>
        </div>
        <p class="deal-accounts-subtitle">Ø¨Ø¯Ù‡ÛŒ Ùˆ Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†ØŒ Ù…Ø´Ø§ÙˆØ±Ø§Ù† Ùˆ Ø¨Ù†Ú¯Ø§Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡</p>
      </header>
      {% comment %} Ø¬Ø¯ÙˆÙ„ Ø¯ÙØªØ± Ø­Ø³Ø§Ø¨ (Ø³Ù†Ø¯ Ú©Ù…ÛŒØ³ÛŒÙˆÙ†) ÛŒØ§ Ø­Ø§Ù„Øª Ø®Ø§Ù„ÛŒ {% endcomment %}
      {% if transaction and ledger_rows %}
        <section class="deal-accounts-ledger-section" aria-labelledby="ledger-heading">
          <div class="ledger-card">
            <div class="ledger-card-header">
              <h2 id="ledger-heading" class="ledger-card-title">Ø¯ÙØªØ± Ø­Ø³Ø§Ø¨ â€” Ø³Ù†Ø¯ Ú©Ù…ÛŒØ³ÛŒÙˆÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡</h2>
              <div class="ledger-legend" role="list">
                <span class="ledger-legend-item ledger-legend-debit" role="listitem">Ø¨Ø¯Ù‡Ú©Ø§Ø±</span>
                <span class="ledger-legend-item ledger-legend-credit" role="listitem">Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±</span>
                <span class="ledger-legend-item ledger-legend-settled" role="listitem">ØªØ³ÙˆÛŒÙ‡â€ŒØ´Ø¯Ù‡</span>
              </div>
            </div>
            <div class="ledger-table-wrapper">
              <table class="ledger-table" role="table">
                <thead>
                  <tr>
                    <th scope="col" class="col-account">Ø­Ø³Ø§Ø¨</th>
                    <th scope="col" class="col-code">Ú©Ø¯</th>
                    <th scope="col" class="col-desc">Ù†ÙˆØ¹ Ø­Ø³Ø§Ø¨</th>
                    <th scope="col" class="col-counterpart">Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„</th>
                    <th scope="col" class="col-debit">Ø¨Ø¯Ù‡Ú©Ø§Ø±</th>
                    <th scope="col" class="col-credit">Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±</th>
                    <th scope="col" class="col-settled">ØªØ³ÙˆÛŒÙ‡â€ŒØ´Ø¯Ù‡</th>
                    <th scope="col" class="col-remaining">Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</th>
                    <th scope="col" class="col-actions">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</th>
                  </tr>
                </thead>
                <tbody>
                  {% for e in ledger_rows %}
                    <tr class="ledger-row">
                      <td class="col-account" data-label="Ø­Ø³Ø§Ø¨">{{ e.account_name }}</td>
                      <td class="col-code" data-label="Ú©Ø¯">{{ e.account_code }}</td>
                      <td class="col-desc" data-label="Ù†ÙˆØ¹ Ø­Ø³Ø§Ø¨">{{ e.account_kind|default:"â€”" }}</td>
                      <td class="col-counterpart" data-label="Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„">{{ e.counterpart_label|default:"â€”" }}</td>
                      <td class="col-debit" data-label="Ø¨Ø¯Ù‡Ú©Ø§Ø±">
                        {% if e.debit %}
                          {{ e.debit|floatformat:0|intcomma }}
                        {% else %}
                          â€”
                        {% endif %}
                      </td>
                      <td class="col-credit" data-label="Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±">
                        {% if e.credit %}
                          {{ e.credit|floatformat:0|intcomma }}
                        {% else %}
                          â€”
                        {% endif %}
                      </td>
                      <td class="col-settled" data-label="ØªØ³ÙˆÛŒÙ‡â€ŒØ´Ø¯Ù‡">
                        {% if e.settled_amount %}
                          {{ e.settled_amount|floatformat:0|intcomma }}
                        {% else %}
                          Û°
                        {% endif %}
                      </td>
                      <td class="col-remaining" data-label="Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡">
                        {% if e.remaining_amount %}
                          {{ e.remaining_amount|floatformat:0|intcomma }}
                        {% else %}
                          Û°
                        {% endif %}
                      </td>
                      <td class="col-actions" data-label="">
                        {% if e.has_payments %}
                          <button type="button"
                                  class="payments-badge"
                                  data-account-code="{{ e.account_code }}">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
                        {% else %}
                          <span class="ledger-no-payments">â€”</span>
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
                <tfoot>
                  <tr class="total-row">
                    <td colspan="4" class="total-row-label">Ø¬Ù…Ø¹ Ø¯ÙØªØ±</td>
                    <td class="col-debit">{{ total_debit|floatformat:0|intcomma }}</td>
                    <td class="col-credit">{{ total_credit|floatformat:0|intcomma }}</td>
                    <td colspan="3" class="total-row-spacer" aria-hidden="true"></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </section>
      {% else %}
        <section class="deal-accounts-empty-section" aria-labelledby="empty-heading">
          <div class="empty-accounts-state">
            <div class="empty-accounts-state-icon" aria-hidden="true">ğŸ“‹</div>
            <h2 id="empty-heading" class="empty-accounts-state-title">Ø³Ù†Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</h2>
            <p class="empty-accounts-state-desc">Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù‡Ù†ÙˆØ² Ø³Ù†Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ (Ú©Ù…ÛŒØ³ÛŒÙˆÙ†) Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
            <p class="empty-accounts-state-hint">
              Ù¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ ØªÙˆØ³Ø· Ù…Ø¯ÛŒØ± Ø¨Ù†Ú¯Ø§Ù‡ØŒ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø°ÛŒâ€ŒÙ†ÙØ¹Ø§Ù† Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø³Ø§Ø®ØªÙ‡ Ùˆ Ø¯Ø± Ø§ÛŒÙ† ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
            </p>
          </div>
        </section>
      {% endif %}
      {% if pending_payments %}
        <section class="deal-accounts-pending-section"
                 aria-labelledby="pending-heading"
                 style="margin-top:1.5rem">
          <h2 id="pending-heading" class="ledger-card-title">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯</h2>
          <p class="payment-modal-hint" style="margin-bottom:0.75rem;">
            {% if can_approve_pending %}
              Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ ØªÙˆØ³Ø· Ù…Ø´Ø§ÙˆØ± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ø¨Ø§ Â«ØªØ§ÛŒÛŒØ¯Â» ØªØ±Ø§Ú©Ù†Ø´ Ø¯Ø± Ø¯ÙØªØ± Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯Ø› Ø¨Ø§ Â«Ø±Ø¯Â» Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù„ØºÙˆ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
            {% else %}
              ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø´Ù…Ø§ Ù¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ø§Ù¾Ø±Ø§ØªÙˆØ± ÛŒØ§ Ù…Ø¯ÛŒØ± Ø¨Ù†Ú¯Ø§Ù‡ Ø¯Ø± Ø¯ÙØªØ± Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
            {% endif %}
          </p>
          <div class="ledger-table-wrapper">
            <table class="ledger-table pending-table" role="table">
              <thead>
                <tr>
                  <th scope="col">Ø­Ø³Ø§Ø¨</th>
                  <th scope="col">Ù†ÙˆØ¹</th>
                  <th scope="col">Ù…Ø¨Ù„Øº (Ø±ÛŒØ§Ù„)</th>
                  <th scope="col">ØªØ§Ø±ÛŒØ®</th>
                  <th scope="col">Ø«Ø¨Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡</th>
                  <th scope="col">ÙˆØ¶Ø¹ÛŒØª</th>
                  {% if can_approve_pending %}<th scope="col">Ø¹Ù…Ù„ÛŒØ§Øª</th>{% endif %}
                </tr>
              </thead>
              <tbody>
                {% for p in pending_payments %}
                  <tr class="pending-row" data-pending-id="{{ p.id }}">
                    <td data-label="Ø­Ø³Ø§Ø¨">{{ p.account.name|default:"â€”" }}</td>
                    <td data-label="Ù†ÙˆØ¹">{{ p.get_direction_display }}</td>
                    <td data-label="Ù…Ø¨Ù„Øº" class="num">{{ p.amount|floatformat:0|intcomma }}</td>
                    <td data-label="ØªØ§Ø±ÛŒØ®">{{ p.date|shamsi_date }}</td>
                    <td data-label="Ø«Ø¨Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡">
                      {% if p.created_by %}
                        {{ p.created_by.get_full_name|default:p.created_by.username }}
                      {% else %}
                        â€”
                      {% endif %}
                    </td>
                    <td data-label="ÙˆØ¶Ø¹ÛŒØª">
                      <span class="pending-status pending-status--{{ p.status }}">{{ p.get_status_display }}</span>
                    </td>
                    {% if can_approve_pending and p.status == 'pending' %}
                      <td data-label="Ø¹Ù…Ù„ÛŒØ§Øª">
                        <button type="button"
                                class="deal-detail-btn deal-detail-btn--primary btn-approve-pending"
                                data-pending-id="{{ p.id }}">ØªØ§ÛŒÛŒØ¯</button>
                        <button type="button"
                                class="deal-detail-btn deal-detail-btn--ghost btn-reject-pending"
                                data-pending-id="{{ p.id }}">Ø±Ø¯</button>
                      </td>
                    {% elif can_approve_pending %}
                      <td data-label="Ø¹Ù…Ù„ÛŒØ§Øª">â€”</td>
                    {% endif %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </section>
      {% endif %}
    </div>
  </div>
  <script>
    window.DEAL_ACCOUNTS_CONFIG = {
      paymentsByAccount: {{ payments_by_account_json|safe }},
      paymentUrl: "{% url 'finance:deal-account-payment' deal.id %}",
      dealId: {{ deal.id }},
      canApprovePending: {{ can_approve_pending|yesno:"true,false" }},
      approvePendingUrlTemplate: "{% url 'finance:pending-deal-payment-approve' deal_id=deal.id pending_id=0 %}",
      rejectPendingUrlTemplate: "{% url 'finance:pending-deal-payment-reject' deal_id=deal.id pending_id=0 %}"
    };
  </script>
{% endblock %}
{% block modals %}
  {% comment %} Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ {% endcomment %}
  <div class="deal-detail-modal-overlay"
       id="dealDetailModal"
       aria-hidden="true"
       role="dialog"
       aria-modal="true"
       aria-labelledby="dealDetailModalTitle">
    <div class="deal-detail-modal">
      <header class="deal-detail-modal-header">
        <h2 class="deal-detail-modal-title" id="dealDetailModalTitle">Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø¹Ø§Ù…Ù„Ù‡: {{ deal.title|default:deal.id }}</h2>
        <button type="button"
                class="deal-detail-modal-close"
                id="dealDetailModalClose"
                aria-label="Ø¨Ø³ØªÙ†">Ø¨Ø³ØªÙ†</button>
      </header>
      <div class="deal-detail-modal-body">
        <div class="detail-grid">
          <section class="detail-card" aria-labelledby="detail-base-heading">
            <h3 id="detail-base-heading" class="detail-card-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡</h3>
            <dl class="detail-kv">
              <div class="detail-kv-row">
                <dt>Ø¹Ù†ÙˆØ§Ù† Ù…Ø¹Ø§Ù…Ù„Ù‡</dt>
                <dd>
                  {{ deal.title|default:"â€”" }}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>ÙˆØ¶Ø¹ÛŒØª</dt>
                <dd>
                  {{ deal.get_status_display|default:deal.status }}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>Ù†ÙˆØ¹</dt>
                <dd>
                  {{ deal.type.name|default:"â€”" }}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>Ø³Ø§Ø²Ù†Ø¯Ù‡</dt>
                <dd>
                  {{ deal.created_by.get_full_name|default:deal.created_by.username }}
                </dd>
              </div>
            </dl>
          </section>
          <section class="detail-card" aria-labelledby="detail-dates-heading">
            <h3 id="detail-dates-heading" class="detail-card-title">ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§</h3>
            <dl class="detail-kv">
              <div class="detail-kv-row">
                <dt>ØªØ§Ø±ÛŒØ® Ù…Ø¨Ø§ÛŒØ¹Ù‡</dt>
                <dd>
                  {% if deal.agreement_date %}
                    {{ deal.agreement_date|shamsi_date }}
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>ØªØ§Ø±ÛŒØ® Ø¯ÙØªØ±Ø®Ø§Ù†Ù‡</dt>
                <dd>
                  {% if deal.office_date %}
                    {{ deal.office_date|shamsi_date }}
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</dt>
                <dd>
                  {{ deal.created_at|shamsi_date:"%Y/%m/%d %H:%M" }}
                </dd>
              </div>
            </dl>
          </section>
          <section class="detail-card" aria-labelledby="detail-amounts-heading">
            <h3 id="detail-amounts-heading" class="detail-card-title">Ù…Ø¨Ø§Ù„Øº</h3>
            <dl class="detail-kv">
              <div class="detail-kv-row">
                <dt>Ù…Ø¨Ù„Øº Ù…Ø¹Ø§Ù…Ù„Ù‡</dt>
                <dd>
                  {% if deal.amount %}
                    {{ deal.amount|floatformat:0|intcomma }} Ø±ÛŒØ§Ù„
                  {% else %}
                    â€”
                  {% endif %}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡</dt>
                <dd>
                  {% if deal.base_price %}
                    {{ deal.base_price|floatformat:0|intcomma }} Ø±ÛŒØ§Ù„
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>Ø§Ø¶Ø§ÙÙ‡ Ù¾Ø±Ø¯Ø§Ø®Øª</dt>
                <dd>
                  {% if deal.overpayment %}
                    {{ deal.overpayment|floatformat:0|intcomma }} Ø±ÛŒØ§Ù„
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù¾Ø±Ø¯Ø§Ø®Øª</dt>
                <dd>
                  {% if deal.overpayment_received %}
                    {{ deal.overpayment_received|floatformat:0|intcomma }} Ø±ÛŒØ§Ù„
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
            </dl>
          </section>
          <section class="detail-card" aria-labelledby="detail-parties-heading">
            <h3 id="detail-parties-heading" class="detail-card-title">Ø·Ø±ÙÛŒÙ†</h3>
            <dl class="detail-kv">
              <div class="detail-kv-row">
                <dt>Ø®Ø±ÛŒØ¯Ø§Ø±Ø§Ù†</dt>
                <dd>
                  {% if deal.buyers.all %}
                    {{ deal.buyers.all|join:"ØŒ " }}
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>ÙØ±ÙˆØ´Ù†Ø¯Ú¯Ø§Ù†</dt>
                <dd>
                  {% if deal.sellers.all %}
                    {{ deal.sellers.all|join:"ØŒ " }}
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
              <div class="detail-kv-row">
                <dt>Ù…Ø´Ø§ÙˆØ±Ø§Ù†</dt>
                <dd>
                  {% if deal.consultants.all %}
                    {{ deal.consultants.all|join:"ØŒ " }}
                  {% else %}
                    Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡
                  {% endif %}
                </dd>
              </div>
            </dl>
          </section>
        </div>
        {% if deal.description %}
          <section class="detail-card detail-card--full"
                   aria-labelledby="detail-desc-heading">
            <h3 id="detail-desc-heading" class="detail-card-title">ØªÙˆØ¶ÛŒØ­Ø§Øª</h3>
            <p class="detail-description">{{ deal.description }}</p>
          </section>
        {% endif %}
      </div>
    </div>
  </div>
  {% comment %} Ù…ÙˆØ¯Ø§Ù„ Ù„ÛŒØ³Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù‡Ø± Ø­Ø³Ø§Ø¨ {% endcomment %}
  <div class="deal-detail-modal-overlay"
       id="paymentsModal"
       aria-hidden="true">
    <div class="deal-detail-modal"
         role="dialog"
         aria-modal="true"
         aria-labelledby="paymentsModalTitle">
      <div class="deal-detail-modal-header">
        <h2 class="deal-detail-modal-title" id="paymentsModalTitle">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø¨</h2>
        <button type="button" class="deal-detail-modal-close" id="paymentsModalClose">Ø¨Ø³ØªÙ†</button>
      </div>
      <div class="deal-detail-modal-body" id="paymentsModalBody">
        <div class="empty-accounts-state">
          <div class="icon">ğŸ“„</div>
          <p>Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
        </div>
      </div>
    </div>
  </div>
  {% comment %} Ù…ÙˆØ¯Ø§Ù„ Ù†Ù…Ø§ÛŒØ´ Ø±Ø³ÛŒØ¯ (ØªØµÙˆÛŒØ±/Ù„ÛŒÙ†Ú©) {% endcomment %}
  <div class="deal-detail-modal-overlay"
       id="receiptModal"
       aria-hidden="true">
    <div class="deal-detail-modal receipt-modal"
         role="dialog"
         aria-modal="true"
         aria-labelledby="receiptModalTitle">
      <div class="deal-detail-modal-header">
        <h2 class="deal-detail-modal-title" id="receiptModalTitle">Ø±Ø³ÛŒØ¯</h2>
        <button type="button" class="deal-detail-modal-close" id="receiptModalClose">Ø¨Ø³ØªÙ†</button>
      </div>
      <div class="deal-detail-modal-body receipt-modal-body"
           id="receiptModalBody">
        <div class="receipt-loading" id="receiptModalLoading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒâ€¦</div>
        <img id="receiptModalImage"
             class="receipt-image"
             alt="Ø±Ø³ÛŒØ¯"
             style="display:none">
        <div class="receipt-fallback"
             id="receiptModalFallback"
             style="display:none">
          <p>Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¯Ø± Ù‚Ø§Ø¨ Ø§Ù…Ù† Ù…Ø±ÙˆØ±Ú¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
          <p>
            <a id="receiptModalOpenNew" href="#" target="_blank" rel="noopener">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø±Ø³ÛŒØ¯ Ø¯Ø± ØªØ¨ Ø¬Ø¯ÛŒØ¯</a>
          </p>
        </div>
      </div>
    </div>
  </div>
  {% comment %} Ù…ÙˆØ¯Ø§Ù„ Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ (Ù¾Ø±Ø¯Ø§Ø®Øª/Ø¯Ø±ÛŒØ§ÙØª) {% endcomment %}
  {% if deal_accounts_list %}
    <div class="deal-detail-modal-overlay"
         id="registerPaymentModal"
         aria-hidden="true">
      <div class="deal-detail-modal"
           role="dialog"
           aria-modal="true"
           aria-labelledby="registerPaymentModalTitle">
        <div class="deal-detail-modal-header">
          <h2 class="deal-detail-modal-title" id="registerPaymentModalTitle">Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´</h2>
          <button type="button"
                  class="deal-detail-modal-close"
                  id="registerPaymentModalClose">Ø¨Ø³ØªÙ†</button>
        </div>
        <div class="deal-detail-modal-body">
          <p class="payment-modal-hint">
            {% if is_consultant_deal_accounts %}
              Ø´Ù…Ø§ Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ù…Ø´Ø§ÙˆØ± ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø±Ø§ÛŒ <strong>Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ</strong> (Ù¾Ø±Ø¯Ø§Ø®Øª/Ø¯Ø±ÛŒØ§ÙØª Ù…Ø´ØªØ±ÛŒ) Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ù‡ÛŒØ¯. ØªØ±Ø§Ú©Ù†Ø´ Ù¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ø§Ù¾Ø±Ø§ØªÙˆØ± ÛŒØ§ Ù…Ø¯ÛŒØ± Ø¨Ù†Ú¯Ø§Ù‡ Ø¯Ø± Ø¯ÙØªØ± Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
            {% else %}
              ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø±Ø§ÛŒ <strong>Ù¾Ø±Ø¯Ø§Ø®Øª/Ø¯Ø±ÛŒØ§ÙØª Ù…Ø´ØªØ±ÛŒ</strong>ØŒ <strong>Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…Ø´Ø§ÙˆØ±</strong> ÛŒØ§ <strong>Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ù…Ø¯ÛŒØ± Ø¨Ù†Ú¯Ø§Ù‡</strong> Ø«Ø¨Øª Ú©Ù†ÛŒØ¯.
            {% endif %}
          </p>
          <form id="registerPaymentForm"
                class="payment-form"
                enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-row">
              <label for="paymentAccount">
                Ø­Ø³Ø§Ø¨ <span class="required">*</span>
              </label>
              <select id="paymentAccount" name="account_id" required>
                <option value="">â€” Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø³Ø§Ø¨ â€”</option>
                {% for acc in deal_accounts_list %}
                  <option value="{{ acc.id }}"
                          data-remaining="{{ acc.remaining_amount|floatformat:0 }}">
                    {{ acc.code }} â€” {{ acc.name }} (Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: {{ acc.remaining_amount|floatformat:0|intcomma }} Ø±ÛŒØ§Ù„)
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="form-row">
              <label for="paymentAmount">
                Ù…Ø¨Ù„Øº (Ø±ÛŒØ§Ù„) <span class="required">*</span>
              </label>
              <input type="text"
                     id="paymentAmount"
                     name="amount"
                     inputmode="numeric"
                     required
                     placeholder="Û±Ù¬Û°Û°Û°Ù¬Û°Û°Û°"
                     data-raw="">
            </div>
            <div class="form-row">
              <label for="paymentDirection">
                Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ <span class="required">*</span>
              </label>
              <select id="paymentDirection" name="direction" required>
                <option value="receive">Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² Ø·Ø±Ù Ø­Ø³Ø§Ø¨</option>
                <option value="pay">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ø·Ø±Ù Ø­Ø³Ø§Ø¨</option>
              </select>
            </div>
            <div class="form-row">
              <label for="paymentDate">ØªØ§Ø±ÛŒØ® (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
              <input type="text"
                     id="paymentDate"
                     name="date"
                     placeholder="Û±Û´Û°Û³/Û°Ûµ/Û±Ûµ ÛŒØ§ 2024-08-06">
            </div>
            <div class="form-row">
              <label for="paymentMethod">Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª/Ø¯Ø±ÛŒØ§ÙØª</label>
              <input type="text"
                     id="paymentMethod"
                     name="method"
                     placeholder="Ù†Ù‚Ø¯ØŒ Ú©Ø§Ø±ØªØŒ Ø­ÙˆØ§Ù„Ù‡ Ùˆ ...">
            </div>
            <div class="form-row">
              <label for="paymentDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
              <textarea id="paymentDescription"
                        name="description"
                        rows="2"
                        placeholder="Ø´Ø±Ø­ ØªØ±Ø§Ú©Ù†Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></textarea>
            </div>
            <div class="form-row">
              <label for="paymentReceipt">Ø¶Ù…ÛŒÙ…Ù‡ / ØªØµÙˆÛŒØ± Ø±Ø³ÛŒØ¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
              <input type="file"
                     id="paymentReceipt"
                     name="receipt"
                     accept="image/*,.pdf,.doc,.docx"
                     class="payment-file-input">
            </div>
            <div class="form-actions">
              <button type="submit" class="deal-detail-btn" id="registerPaymentSubmit">Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´</button>
              <span class="form-message" id="registerPaymentMessage"></span>
            </div>
          </form>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
{% block extra_scripts %}
  <script src="{% static 'js/deal_accounts.js' %}"></script>
{% endblock %}
