{% extends "base.html" %}
{% load static %}
{% block title %}پروفایل{% endblock %}
{% block body_class %}profile-page{% endblock %}
{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}
{% block content %}
  <div class="profile-wrapper">
    {% if messages %}
      <div class="profile-messages">
        {% for message in messages %}<div class="alert" role="alert">{{ message }}</div>{% endfor %}
      </div>
    {% endif %}
    <div class="profile-back-wrap">
      <a href="{% url 'dashboard' %}" class="profile-back">← داشبورد</a>
    </div>
    <div class="profile-hero">
      <div class="profile-avatar">{{ request.user.get_full_name|default:request.user.username|slice:":1" }}</div>
      <h1 class="profile-display-name">{{ request.user.get_full_name|default:request.user.username }}</h1>
      <div class="profile-badges">
        <span class="profile-badge"><strong>نقش:</strong> {{ role_display }}</span>
        <span class="profile-badge"><strong>بنگاه:</strong> {{ office_display }}</span>
      </div>
    </div>
    <div class="profile-card profile-form">
      <h2 class="profile-card-title">ویرایش اطلاعات</h2>
      <form method="post" action="{% url 'profile' %}">
        {% csrf_token %}
        <div class="form-group">
          <label class="form-label" for="id_first_name">نام</label>
          <input type="text"
                 name="first_name"
                 id="id_first_name"
                 class="profile-input"
                 placeholder="نام"
                 value="{{ profile_form.first_name.value|default:'' }}"
                 maxlength="150"
                 autocomplete="given-name">
          {% if profile_form.first_name.errors %}
            <ul class="errorlist">
              {% for e in profile_form.first_name.errors %}<li>{{ e }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>
        <div class="form-group">
          <label class="form-label" for="id_last_name">نام خانوادگی</label>
          <input type="text"
                 name="last_name"
                 id="id_last_name"
                 class="profile-input"
                 placeholder="نام خانوادگی"
                 value="{{ profile_form.last_name.value|default:'' }}"
                 maxlength="150"
                 autocomplete="family-name">
          {% if profile_form.last_name.errors %}
            <ul class="errorlist">
              {% for e in profile_form.last_name.errors %}<li>{{ e }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>
        <div class="form-group">
          <label class="form-label" for="id_phone_number">شماره تلفن</label>
          <input type="text"
                 name="phone_number"
                 id="id_phone_number"
                 class="profile-input"
                 placeholder="۰۹۱۲۳۴۵۶۷۸۹"
                 value="{{ profile_form.phone_number.value|default:'' }}"
                 maxlength="20"
                 autocomplete="tel">
          {% if profile_form.phone_number.errors %}
            <ul class="errorlist">
              {% for e in profile_form.phone_number.errors %}<li>{{ e }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>
        <div class="profile-actions">
          <button type="submit"
                  name="update_profile"
                  value="1"
                  class="btn-profile btn-profile-primary">ذخیره</button>
        </div>
      </form>
    </div>
    <details class="profile-card profile-password-toggle">
      <summary>تغییر رمز عبور</summary>
      <div class="profile-password-content profile-form">
        <form method="post" action="{% url 'profile' %}">
          {% csrf_token %}
          <div class="form-group">
            <label class="form-label" for="id_old_password">رمز فعلی</label>
            <input type="password"
                   name="old_password"
                   id="id_old_password"
                   class="profile-input"
                   autocomplete="current-password"
                   required>
            {% if password_form.old_password.errors %}
              <ul class="errorlist">
                {% for e in password_form.old_password.errors %}<li>{{ e }}</li>{% endfor %}
              </ul>
            {% endif %}
          </div>
          <div class="form-group">
            <label class="form-label" for="id_new_password1">رمز جدید</label>
            <input type="password"
                   name="new_password1"
                   id="id_new_password1"
                   class="profile-input"
                   autocomplete="new-password"
                   required>
            {% if password_form.new_password1.errors %}
              <ul class="errorlist">
                {% for e in password_form.new_password1.errors %}<li>{{ e }}</li>{% endfor %}
              </ul>
            {% endif %}
            {% if password_form.new_password1.help_text %}
              <p class="helper-text">{{ password_form.new_password1.help_text }}</p>
            {% endif %}
          </div>
          <div class="form-group">
            <label class="form-label" for="id_new_password2">تکرار رمز جدید</label>
            <input type="password"
                   name="new_password2"
                   id="id_new_password2"
                   class="profile-input"
                   autocomplete="new-password"
                   required>
            {% if password_form.new_password2.errors %}
              <ul class="errorlist">
                {% for e in password_form.new_password2.errors %}<li>{{ e }}</li>{% endfor %}
              </ul>
            {% endif %}
          </div>
          <div class="profile-actions">
            <button type="submit"
                    name="change_password"
                    value="1"
                    class="btn-profile btn-profile-secondary">تغییر رمز</button>
          </div>
        </form>
      </div>
    </details>
  </div>
{% endblock %}
